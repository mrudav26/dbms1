// Source code is decompiled from a .class file using FernFlower decompiler.
import java.io.IOException;
import java.sql.SQLException;
import java.util.List;
import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

public class ControlServlet extends HttpServlet {
   private static final long serialVersionUID = 1L;
   private userDAO userDAO = new userDAO();
   private String currentUser;
   private HttpSession session = null;

   public ControlServlet() {
   }

   public void init() {
      this.userDAO = new userDAO();
      this.currentUser = "";
   }

   protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
      this.doGet(request, response);
   }

   protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
      System.out.println(action);

      try {
         switch (action) {
            case "/initialize":
               this.userDAO.init();
               System.out.println("Database successfully initialized!");
               this.rootPage(request, response, "");
               break;
            case "/list":
               System.out.println("The action is: list");
               this.listUser(request, response);
               break;
            case "/root":
               this.rootPage(request, response, "");
               break;
            case "/register":
               this.register(request, response);
               break;
            case "/login":
               this.login(request, response);
               break;
            case "/logout":
               this.logout(request, response);
         }
      } catch (Exception var5) {
         System.out.println(var5.getMessage());
      }

   }

   private void listUser(HttpServletRequest request, HttpServletResponse response) throws SQLException, IOException, ServletException {
      System.out.println("listUser started: 00000000000000000000000000000000000");
      List<user> listUser = this.userDAO.listAllUsers();
      request.setAttribute("listUser", listUser);
      RequestDispatcher dispatcher = request.getRequestDispatcher("UserList.jsp");
      dispatcher.forward(request, response);
      System.out.println("listPeople finished: 111111111111111111111111111111111111");
   }

   private void rootPage(HttpServletRequest request, HttpServletResponse response, String view) throws ServletException, IOException, SQLException {
      System.out.println("root view");
      request.setAttribute("listUser", this.userDAO.listAllUsers());
      request.getRequestDispatcher("rootView.jsp").forward(request, response);
   }

   protected void login(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException, SQLException {
      String email = request.getParameter("email");
      String password = request.getParameter("password");
      if (email.equals("root") && password.equals("pass1234")) {
         System.out.println("Login Successful! Redirecting to root");
         this.session = request.getSession();
         this.session.setAttribute("username", email);
         this.rootPage(request, response, "");
      } else if (this.userDAO.isValid(email, password)) {
         this.currentUser = email;
         System.out.println("Login Successful! Redirecting");
         request.getRequestDispatcher("activitypage.jsp").forward(request, response);
      } else {
         request.setAttribute("loginStr", "Login Failed: Please check your credentials.");
         request.getRequestDispatcher("login.jsp").forward(request, response);
      }

   }

   private void register(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException, SQLException {
      String firstName = request.getParameter("firstName");
      String lastName = request.getParameter("lastName");
      String phone = request.getParameter("Phone No.")
      String address_street_num = request.getParameter("address_street_num"); 
      String address_street = request.getParameter("address_street"); 
      String address_city = request.getParameter("address_city"); 
      String address_state = request.getParameter("address_state"); 
      String address_zip_code = request.getParameter("address_zip_code");
      String cname = request.getParameter("cname")
      String ccnum = request.getParameter("ccnum")
      String cexp = request.getParameter("cexp")
      String ccode = request.getParameter("ccode")
      String email = request.getParameter("email");
      String password = request.getParameter("password");
      String conformation = request.getParameter("confirmation")
      if (password.equals(confirm)) {
         if (!this.userDAO.checkEmail(email)) {
            System.out.println("Registration Successful! Added to database");
            user users = new user(firstName, lastName, phone, address_street_num,  address_street,  address_city,  address_state,  address_zip_code, cname, ccnum, cexp, ccode, email, password);
            this.userDAO.insert(users);
            response.sendRedirect("login.jsp");
         } else {
            System.out.println("Username taken, please enter new username");
            request.setAttribute("errorOne", "Registration failed: Username taken, please enter a new username.");
            request.getRequestDispatcher("register.jsp").forward(request, response);
         }
      } else {
         System.out.println("Password and Password Confirmation do not match");
         request.setAttribute("errorTwo", "Registration failed: Password and Password Confirmation do not match.");
         request.getRequestDispatcher("register.jsp").forward(request, response);
      }

   }

   private void logout(HttpServletRequest request, HttpServletResponse response) throws IOException {
      this.currentUser = "";
      response.sendRedirect("login.jsp");
   }
}
